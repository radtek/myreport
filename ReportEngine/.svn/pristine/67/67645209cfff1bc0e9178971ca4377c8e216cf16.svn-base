using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Reflection;
using System.Collections;

namespace PMS.Libraries.ToolControls.Report.Elements.Util
{
    public class DeepClone
    {
        public static object Clone(object obj)
        {
            #region
            //if (null == obj)
            //{
            //    return null;
            //}
            //FieldInfo[] fis = obj.GetType().GetFields(BindingFlags.Public | BindingFlags.Instance
            //                                                                     | BindingFlags.NonPublic);
            //ConstructorInfo[] ci = obj.GetType().GetConstructors(BindingFlags.Public | BindingFlags.Instance
            //                                                                     | BindingFlags.NonPublic);
            //object returnObject = null;//ci[0].Invoke(new object[] {null });
            //ParameterInfo[] pis = ci[0].GetParameters();
            //if (null != pis && pis.Length > 0)
            //{
            //    returnObject = ci[0].Invoke(new object[] { null });
            //}
            //else
            //{
            //    returnObject = ci[0].Invoke(null);
            //}
            ////if (null != ci && ci.Length > 0)
            ////{
            ////    object returnObject = null;//ci[0].Invoke(new object[] {null });
            ////    ParameterInfo[] pis = ci[0].GetParameters();
            ////    if (null != pis && pis.Length > 0)
            ////    {
            ////        returnObject = ci[0].Invoke(new object[] { null });
            ////    }
            ////    else
            ////    {
            ////        returnObject = ci[0].Invoke(null);
            ////    }

            ////    if (null != fis && fis.Length > 0)
            ////    {
            ////        foreach (FieldInfo fi in fis)
            ////        {

            ////            object fiValue = fi.GetValue(obj);
            ////            if (null != fiValue)
            ////            {
            ////                bool isValueType = fiValue.GetType().IsSubclassOf(typeof(ValueType));
            ////                if (isValueType)
            ////                {
            ////                    //拷贝值类型成员
            ////                    fi.SetValue(returnObject, fiValue);
            ////                }
            ////                else
            ////                {
            ////                    //引用类型继续递归 
            ////                    //获取是否标记了DeepCloneAttribute
            ////                    //object[] attributes = fi.GetCustomAttributes(typeof(DeepCloneAttribute), true);
            ////                    //if (null != attributes && attributes.Length > 0)
            ////                    //{
            ////                        fi.SetValue(returnObject, Clone(fiValue));
            ////                    //}

            ////                }
            ////            }

            ////        }

            ////        return returnObject;
            ////    }
            ////}
            //if (null != fis && fis.Length > 0)
            //{
            //    for (int i = 0; i < fis.Length; i++)
            //    {
            //        Queue<FieldInfo> queue = new Queue<FieldInfo>();
            //        queue.Enqueue(fis[i]);
            //        Object tempObj = obj;
            //       //object tempReturnObj = null;
            //        while (queue.Count > 0)
            //        {
            //            FieldInfo fi = queue.Dequeue();
            //            object fiValue = fi.GetValue(tempObj);
            //            if (null != fiValue)
            //            {
            //                bool isValueType = fiValue.GetType().IsSubclassOf(typeof(ValueType));
            //                if (isValueType)
            //                {
            //                    //拷贝值类型成员
            //                    fi.SetValue(returnObject, fiValue);
            //                }
            //                else
            //                {
            //                    FieldInfo[] temp = fiValue.GetType().GetFields(BindingFlags.Public | BindingFlags.Instance
            //                                                                 | BindingFlags.NonPublic);
            //                    if (null != temp && temp.Length > 0)
            //                    {
            //                        foreach (FieldInfo tempFi in temp)
            //                        {
            //                            queue.Enqueue(tempFi);
            //                        }
            //                        tempObj = fiValue;
            //                    }
            //                }

            //            }
            //        }
            //    }
            //    return returnObject;
            //}
            #endregion
            return null;
        }
    }
}
